<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Karma Tree üå≥</title>
  <style>
    body { margin: 0; overflow: hidden; background: #e0f5e9; }
    canvas { display: block; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.154/build/three.min.js"></script>
<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xe0f5e9);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.set(0, 10, 30);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lights
scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.5));
const dirLight = new THREE.DirectionalLight(0xffffff, 1);
dirLight.position.set(10, 20, 10);
scene.add(dirLight);

// Ground
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(80, 80),
  new THREE.MeshLambertMaterial({ color: 0x88cc88 })
);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

// üçÉ Load your leaf texture from GitHub Pages
const leafTexture = new THREE.TextureLoader().load(
  "https://jeroenvelderen.github.io/karma-tree/leaf.png"
);

// üå≥ Tree generator
function createTree(karma) {
  const group = new THREE.Group();

  // --- Trunk ---
  const trunkHeight = 8;
  const trunk = new THREE.Mesh(
    new THREE.CylinderGeometry(0.7, 1, trunkHeight, 12),
    new THREE.MeshLambertMaterial({ color: 0x8b5a2b })
  );
  trunk.position.y = trunkHeight / 2;
  group.add(trunk);

  // --- Leaves = Karma ---
  const leafGeom = new THREE.PlaneGeometry(1.5, 1.5);
  const leafMat = new THREE.MeshLambertMaterial({
    map: leafTexture,
    transparent: true,
    side: THREE.DoubleSide
  });

  const leafCount = Math.min(karma * 5, 1000); // cap for performance

  for (let i = 0; i < leafCount; i++) {
    const leaf = new THREE.Mesh(leafGeom, leafMat);

    const radius = 4 + Math.random() * 3;
    const angle = Math.random() * Math.PI * 2;
    const height = trunkHeight - 2 + Math.random() * 5;

    leaf.position.set(
      Math.cos(angle) * radius,
      height,
      Math.sin(angle) * radius
    );

    leaf.rotation.y = Math.random() * Math.PI;
    leaf.rotation.x = (Math.random() - 0.5) * 0.5;

    group.add(leaf);
  }

  return group;
}

// Example: 120 karma = lush tree
scene.add(createTree(120));

// Animate
function animate() {
  requestAnimationFrame(animate);
  scene.rotation.y += 0.002; // slow spin
  renderer.render(scene, camera);
}
animate();

window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>